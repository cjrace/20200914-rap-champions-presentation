<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Where RAP meets analysts</title>
    <meta charset="utf-8" />
    <meta name="author" content="Cam Race" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Where RAP meets analysts
## Our journey in DfE
### Cam Race
### 2020/09/08 (updated: 2020/09/08)

---






# What I'll cover

--

- Our plan for implementing RAP - setting the scope and details

--

- Work so far - setting a plan, documentation, dissemination platform

--

- Focused example - automated screening of data files against standards

--

- Next steps - automating QA more widely

???

Test notes for myself

---

class: inverse

# What is RAP

--

Don't worry, I'm not going to preach the choir here

--

This was critical to start off with - we couldn't start being effective until we knew what RAP looked like for us

--

In order to do that, we clearly defined the scope of it...

.center[![Arrows defining the scope of DfE RAP plan](examples/RAP-Scope-Arrow.png)]

---

# What is RAP

Our overview:

.center[![Overview of DfE RAP plan](examples/RAP-Process-Overview.png)]

---

class: inverse

# What is RAP

Our diagram for what this means in practice:

.center[![Hexagons breaking down RAP to real world examples](examples/RAP-in-practice.png)]

---

class: inverse

# Explore Education Statistics

A big part of this has been utilising the new dissemination platform as a catalyst

--

Change was already coming, therefore it was an ideal time to jump on the back of it to make that change an even better and deeper one

--

Our data files had to be standardised to run the platform off of the aggregated data

This meant that we could get senior managers to enforce analysts using EES, and therefore indirectly enforce any standards we set for data that had to go on there

--

Brief demo of [Explore Education Statistics](https://explore-education-statistics.service.gov.uk/)

---

class: inverse

# Guidance

A key part of RAP is documentation, and implementing RAP has been no different

--

We have an [rmarkdown website](https://rsconnect/rsc/stats-production-guidance/) where all of our guidance is stored

--

Note that this is not publicly accessible, it is limited to DfE only as it runs off of our rsconnect servers

---

# Data standards

Built around principles of tidy data

--

Essentially:

- Every row refers to a single observational unit
- Every column refers to a single variable 
-- 'filters' for categorical variables
-- 'indicators' for the numeric measures that we report
- Specific standards around time and geography so the that platform can handle them

--

Example 1

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; time_period &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; time_identifier &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; geographic_level &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; country_code &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; country_name &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; region_name &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; region_code &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; old_la_code &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; la_name &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; new_la_code &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; phase_type_grouping &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; pupil_sen_status &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; primary_need &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; number_of_pupils &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 201920 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Academic year &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; National &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; E92000001 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; England &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; State-funded primary &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Statement or EHC &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Autistic Spectrum Disorder &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 25111 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 201920 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Academic year &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Regional &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; E92000001 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; England &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; North East &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; E12000001 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; State-funded primary &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Statement or EHC &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Autistic Spectrum Disorder &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 804 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 201920 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Academic year &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Local authority &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; E92000001 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; England &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; South East &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; E12000008 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 872 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Wokingham &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; E06000041 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; State-funded primary &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Statement or EHC &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Autistic Spectrum Disorder &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 77 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 201920 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Academic year &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Local authority &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; E92000001 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; England &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; London &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; E12000007 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 309 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Haringey &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; E09000014 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; State-funded primary &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Statement or EHC &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Autistic Spectrum Disorder &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 262 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 201920 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Academic year &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Local authority &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; E92000001 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; England &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; London &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; E12000007 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 209 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Lewisham &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; E09000023 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; State-funded primary &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Statement or EHC &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Autistic Spectrum Disorder &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 274 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 201920 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Academic year &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Local authority &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; E92000001 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; England &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; London &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; E12000007 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 204 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Hackney &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; E09000012 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; State-funded primary &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Statement or EHC &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Autistic Spectrum Disorder &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 266 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;


--

Benefits 

- Machine readable
- 3* open data standards
- Consistent across totally different areas (show second example)



--

Still have debates now, where is the line between levels of categorical variable and a separate measurable variable, balance between 'molten' and 'tidy'.

--

It's been a battle at times as you can imagine, though we've aimed to give analysts as much flexibility as we can within the constraints.


---

# Now we have standards, how can we check against them?

Example standards to check for

Me manually checking 

Motivation for tool
- Save time
- Accuracy
- Reliability
- Remove single-person dependency
- Empower analysts to do this themselves

Design and usage 

How it's evolved based on feedback

The feedback I've had

---

# Notes to fit in

User focus
- Allowing analysts to take advantage of RAP without the barrier of technical knowledge
- Fear of RAP and R and code


---

# First iteration

Basic checks in an Rscript

Output in console

Run by myself, and manually fed back to teams

A number of things to improve, though one I'll highlight is how the tests could fail early, which goes against the best practice in automated testing where you want maximum coverage, so that you can get as much useful information as possible, and minimise the need to rerun - I'll come back to this later

---

# Second iteration

--

Rmarkdown report to send to analysts 

--

- Version controlled using git, in a public github repo

--

- Saved me time manually checking through results

--

- Gave an audit trail of the screening for future reference

---

# Third iteration

Similar structure, with more tests, summary stats and a console only option for larger files

--

- More useful information to see at a glance (progressive disclosure and whatnot)

--

- Increased speed/efficiency, particularly when initially testing data and getting fails

--

- First time starting to think about the length of time the code takes to run as file sizes increased

--

- Using renv for package handling

---

# Setup video

I found that I was spending hours of my time going through with analysts setting this up, repeating the same things over and over

--

So rather than constantly doing the verbal equivalent of repeating the same code over and over, I recorded a 10 minute youtube video instead

--

- Walked through everything from getting the correct R and RStudio versions from the software centre to understanding the reports that came out

--

- Saved myself sitting beside each of the analysts at their desks to do this

--

- Proved very popular, empowering analysts, and effective in reducing repetitive queries to me

--

- I'm also fairly sure that this alone dramatically increased the number of publication teams who had a version of R/RStudio on their machines in our department

---

# renv

As great as renv is, there were still issues with it, it wasn't working for everyone, and I ended up scrapping it in favour of this temporary solution to tide me over until the next iteration came along

- Code

---

# Current iteration 

Shiny app

--

- Back to renv

--

- Removes R and Rstudio barrier

--

- Reduces dependency issues to server only, rather than 100+ different laptops

--

- Single version of the truth, no need to redownload/pull latest version

--

- Increased speed - using profvis to profile code, highlight slowest parts and refactored accordingly

--

- Increased test coverage - now 60 checks and counting,0 with preliminary stages to allow for maximum coverage while minimising confusing cross-errors where possible


--

- Automated tests using testthat and shinytest that run locally to automate the testing of any new code that goes into the app

---

# Particularly useful tests

--

Do as separate pages with code for the test underneath

- Duplicate rows - `janitor::get_dupes()` - almost scary how many analysts started to notice things in their data after I added this test

--

- Utilising a matrix to run geography checks against rather than a mass of if this then that

--

- White space, it can lead to so many issues, and can be impossible to spot manually

--

- profvis - for spotting unnecessary uses of `grepl()`, where `vector_of_values %in% dataset$column` would suffice, along with `use.names = FALSE` for `unlist()`, incredible time savings

--

- testthat and shinytest, both very easy to use and quick to set up, saves a tonne of time fixing the same mistakes - rprofile function

--

- styler - though make sure you're version controlling - rprofile function

--

- Commenting in a way to make use of the outline as scripts get longer - Ctrl-Shft-O in RStudio

---

# Next steps

--

Integrate automated tests into DevOps - have struggled so far, though looking at options

--

Automated QA / sense checking in app if a file passes

--

Continue to build on documentation, and features/code to help analysts make the most of RAP

--

Further work to push this with our HoP, and get pressure from the top to actively do this


---

# Recap

In some ways, you could say it's been quite simple:

--

- Defined what 'RAP' was to us
- Targetted specific areas of that plan
- Iterated the solutions based on feedback
- All the while learning more and more about R and what can be done with it
- Keep pushing to improve moving forwards

???

All of the standard things that any project should do, however, the more interesting bit is the challenges we faced

---

# Recap

--

3 biggest challenges

--

1. Understanding why things are the way they are

???
This can be particularly tough. It's easy to look at a group of analysts and spot how their processes could be improved, it's much harder to look at why what they are doing may actually be the best way for them

--

2. Working out how to effectively implement RAP using knowledge of 1.

???
Once you have the knowledge of why things are the way they are, you can then decide the best ways to change that, for us that has meant constantly adapting and trying to lower the barrier to RAP, while also continuing to encourage and push people to learn and develop this themselves

--

3. Having a limited resource pool and many knowledge barriers (both personally and around our division - see 1. and 2.)

???
I personally started this with limited knowledge, the extent of which was pretty much that basic code I showed you 

So I've been learning throughout, and that challenge has been an enjoyable one

A trickier part however has been the lack of knowledge around our area, and how even things such as getting RStudio onto someones machine can prove challenging

--

Ultimately all have been overcome by a lot of effort, though it's not always simple or easy...

---

class: center, middle

# Thanks!

Slides available at [...]()

Made with [xarigan](https://bookdown.org/yihui/rmarkdown/xaringan.html) rmarkdown extension

Any questions?

Contact: [cameron.race@education.gov.uk](mailto:cameron.race@education.gov.uk)

???

Thank you all for listening

Slides are available at that link there

This was made with xarigan package, which is an extension for rmarkdown, and I'd really recommend you check it out, the amount of flexibility is incredible and the keyboard shortcuts are really nice when presenting

I think there's a few minutes now if anyone has any questions, though there's also my email there if you have questions or suggestions afterwards
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create();
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
